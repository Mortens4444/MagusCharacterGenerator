<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:conv="clr-namespace:Mtf.LanguageService.MAUI.Converters;assembly=Mtf.LanguageService.MAUI"
             xmlns:converters="clr-namespace:M.A.G.U.S.Assistant.Converters"
             xmlns:mcc="clr-namespace:Mtf.Maui.Controls.Converters;assembly=Mtf.Maui.Controls"
             xmlns:v="clr-namespace:Mtf.LanguageService.MAUI.Views;assembly=Mtf.LanguageService.MAUI"
             xmlns:mv="clr-namespace:M.A.G.U.S.Assistant.Views"
             xmlns:vm="clr-namespace:M.A.G.U.S.Assistant.ViewModels"
             xmlns:t="clr-namespace:M.A.G.U.S.Things;assembly=M.A.G.U.S."
             xmlns:local="clr-namespace:M.A.G.U.S.Qualifications;assembly=M.A.G.U.S."
             xmlns:q="clr-namespace:M.A.G.U.S.GameSystem.Qualifications;assembly=M.A.G.U.S."
             xmlns:mc="clr-namespace:Mtf.Maui.Controls;assembly=Mtf.Maui.Controls"
             x:ClassModifier="internal"
             x:DataType="vm:CharacterViewModel"
             x:Class="M.A.G.U.S.Assistant.Views.CharacterDetailsView">

    <ContentView.Resources>
        <ResourceDictionary>
            <conv:EnumDescriptionTranslationConverter x:Key="EnumDescriptionTranslationConverter" />
            <conv:TranslationConverter x:Key="TranslationConverter" />
            <converters:EquipmentSorterConverter x:Key="EquipmentSorter" />
            <converters:QualificationNameConverter x:Key="QualificationNameConverter" />
            <converters:QualificationSorter x:Key="QualificationSorter" />
            <converters:SpecialQualificationNameConverter x:Key="SpecialQualificationNameConverter" />
            <mcc:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
            <mcc:BoolToVisibilityConverter x:Key="NotBoolToVisibilityConverter" Invert="True" />
        </ResourceDictionary>
    </ContentView.Resources>
    
    <VerticalStackLayout Spacing="15" Padding="15">

        <!-- Név, faj, kaszt, jellem, TSZ -->
        <Border Style="{StaticResource BoxBorder}">
            <VerticalStackLayout>
                <Grid ColumnDefinitions="*,Auto">
                    <mc:EntryWithLabel Label="Character name" Text="{Binding Character.Name}" />
                </Grid>

                <BoxView HeightRequest="1" Color="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}" Margin="0,5"/>
                <Grid ColumnDefinitions="*, *"
                        RowDefinitions="Auto, Auto, Auto"
                        MinimumWidthRequest="100"
                        RowSpacing="5">

                    <mc:EntryWithLabel Label="Race"
                                       Text="{Binding Race, Converter={StaticResource TranslationConverter}}"
                                       HorizontalOptions="Center"
                                       IsEnabled="False" />

                    <mc:EntryWithLabel Label="Class"
                                       Text="{Binding Class, Converter={StaticResource TranslationConverter}}"
                                       HorizontalOptions="Center"
                                       IsEnabled="False"
                                       Grid.Column="1" />

                    <mc:EntryWithLabel Label="Experience level"
                                       Text="{Binding Level}"
                                       HorizontalOptions="Center"
                                       IsEnabled="False"
                                       Grid.Row="1"
                                       Grid.ColumnSpan="2" />


                    <!--<Grid Grid.Row="1" ColumnDefinitions="*, Auto">
                        <Label Grid.Column="0" Text="Player character" VerticalOptions="Center" LineBreakMode="WordWrap" />
                        <Switch Grid.Column="1" IsToggled="{Binding PlayerCharacter}" />
                    </Grid>-->

                    <Picker ItemsSource="{Binding Alignments}"
                            ItemDisplayBinding="{Binding ., Converter={StaticResource EnumDescriptionTranslationConverter}}"
                            SelectedItem="{Binding Alignment}"
                            VerticalOptions="Center"
                            WidthRequest="220"
                            Grid.Row="1"
                            Grid.Column="1" />
                </Grid>
            </VerticalStackLayout>
        </Border>

        <!-- Képességek -->
        <VerticalStackLayout Spacing="10">
            <Border Style="{StaticResource BoxBorder}">
                <VerticalStackLayout>
                    <Label Text="Abilities" Style="{StaticResource HeaderLabel}"/>
                    <Grid ColumnDefinitions="*, *" RowDefinitions="Auto, Auto, Auto, Auto, Auto" RowSpacing="5" MinimumHeightRequest="200">
                        <mc:EntryWithLabel Label="Strength" Text="{Binding Strength}" IsEnabled="False" Grid.Row="0" Grid.Column="0" />
                        <mc:EntryWithLabel Label="Stamina" Text="{Binding Stamina}" IsEnabled="False" Grid.Row="0" Grid.Column="1" />
                        <mc:EntryWithLabel Label="Quickness" Text="{Binding Quickness}" IsEnabled="False" Grid.Row="1" Grid.Column="0" />
                        <mc:EntryWithLabel Label="Dexterity" Text="{Binding Dexterity}" IsEnabled="False" Grid.Row="1" Grid.Column="1" />
                        <mc:EntryWithLabel Label="Health" Text="{Binding Health}" IsEnabled="False" Grid.Row="2" Grid.Column="0" />
                        <mc:EntryWithLabel Label="Beauty" Text="{Binding Beauty}" IsEnabled="False" Grid.Row="2" Grid.Column="1" />
                        <mc:EntryWithLabel Label="Willpower" Text="{Binding Willpower}" IsEnabled="False" Grid.Row="3" Grid.Column="0" />
                        <mc:EntryWithLabel Label="Intelligence" Text="{Binding Intelligence}" IsEnabled="False" Grid.Row="3" Grid.Column="1" />
                        <mc:EntryWithLabel Label="Astral" Text="{Binding Astral}" IsEnabled="False" Grid.Row="4" Grid.Column="0" />
                        <mc:EntryWithLabel Label="Erudition" Text="{Binding Erudition}" IsEnabled="False" Grid.Row="4" Grid.Column="1" IsVisible="{Binding PlayerCharacter, Converter={StaticResource NotBoolToVisibilityConverter}}" />
                    </Grid>
                </VerticalStackLayout>
            </Border>
        </VerticalStackLayout>

        <VerticalStackLayout Spacing="10">
            <!-- Életerő -->
            <Border Style="{StaticResource BoxBorder}">
                <VerticalStackLayout>
                    <Label Text="Health" Style="{StaticResource HeaderLabel}"/>
                    <Grid ColumnDefinitions="*, *" RowDefinitions="Auto, Auto">
                        <mc:EntryWithLabel Label="Max. HP" Text="{Binding MaxHealthPoints}" IsEnabled="False" WidthRequest="100" Grid.Row="0" />
                        <mc:EntryWithLabel Label="Act. HP" Text="{Binding HealthPoints}" IsEnabled="False" WidthRequest="100" Grid.Column="1" />
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <!-- Fájdalomtűrés -->
            <Border Style="{StaticResource BoxBorder}">
                <VerticalStackLayout>
                    <Label Text="Pain resistance" Style="{StaticResource HeaderLabel}"/>
                    <Grid ColumnDefinitions="*, *" RowDefinitions="Auto, Auto, Auto">
                        <mc:EntryWithLabel Label="Max. PRP" Text="{Binding MaxPainTolerancePoints}" IsEnabled="False" WidthRequest="100" />
                        <mc:EntryWithLabel Label="Act. PRP" Text="{Binding PainTolerancePoints}" IsEnabled="False" WidthRequest="100" Grid.Row="1" />
                        <mc:EntryWithLabel Label="Max. PRP/level" Text="{Binding PainToleranceModifierFormula}" IsEnabled="False" WidthRequest="100" Grid.Column="1" />
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <!-- Harcértékek -->
            <Border Style="{StaticResource BoxBorder}">
                <VerticalStackLayout>
                    <Label Text="Combat values" Style="{StaticResource HeaderLabel}"/>

                    <Grid ColumnDefinitions="*, *" ColumnSpacing="10" RowDefinitions="Auto, Auto">
                        <Label Text="Primary weapon" Grid.Row="0" Grid.Column="0" />
                        <Picker Title="Select primary weapon"
                                ItemsSource="{Binding AvailableWeapons}"
                                ItemDisplayBinding="{Binding Name, Converter={StaticResource TranslationConverter}}"
                                SelectedItem="{Binding PrimaryWeapon}"
                                Grid.Row="1" Grid.Column="0" />

                        <Label Text="Secondary weapon" Grid.Row="0" Grid.Column="1" />
                        <Picker Title="Select secondary weapon"
                                ItemsSource="{Binding AvailableWeapons}"
                                ItemDisplayBinding="{Binding Name, Converter={StaticResource TranslationConverter}}"
                                SelectedItem="{Binding SecondaryWeapon}"
                                Grid.Row="1" Grid.Column="1" />
                    </Grid>

                    <Picker ItemsSource="{Binding AvailableCombatValueModifiers}"
                            ItemDisplayBinding="{Binding ., Converter={StaticResource EnumDescriptionTranslationConverter}}"
                            SelectedItem="{Binding SelectedCombatValueModifier, Mode=TwoWay}"
                            WidthRequest="220"/>

                    <Grid ColumnDefinitions="*, *" RowDefinitions="Auto, Auto, Auto">
                        <mc:NumericUpDownWithLabel Label="Initiator value" Minimum="{Binding OriginalInitiateValue}" Maximum="{Binding MaxInitiateValue}" Value="{Binding InitiateValue, Mode=TwoWay}" IsVisible="{Binding CanAllocateCombatModifier, Converter={StaticResource BoolToVisibilityConverter}}" />
                        <mc:EntryWithLabel Label="Initiator value" Text="{Binding InitiateValue}" IsEnabled="False" IsVisible="{Binding CanAllocateCombatModifierBase, Converter={StaticResource BoolToVisibilityConverter}}" />
                        <mc:EntryWithLabel Label="Initiator value" Text="{Binding InitiateValueWithSelectedWeapon}" IsEnabled="False" IsVisible="{Binding CanAllocateCombatModifierWithWeapon, Converter={StaticResource BoolToVisibilityConverter}}" />

                        <mc:NumericUpDownWithLabel Label="Attack value" Minimum="{Binding OriginalAttackValue}" Maximum="{Binding MaxAttackValue}" Value="{Binding AttackValue, Mode=TwoWay}" IsVisible="{Binding CanAllocateCombatModifier, Converter={StaticResource BoolToVisibilityConverter}}" Grid.Column="1" />
                        <mc:EntryWithLabel Label="Attack value" Text="{Binding AttackValue}" IsEnabled="False" IsVisible="{Binding CanAllocateCombatModifierBase, Converter={StaticResource BoolToVisibilityConverter}}" Grid.Column="1" />
                        <mc:EntryWithLabel Label="Attack value" Text="{Binding AttackValueWithSelectedWeapon}" IsEnabled="False" IsVisible="{Binding CanAllocateCombatModifierWithWeapon, Converter={StaticResource BoolToVisibilityConverter}}" Grid.Column="1" />

                        <mc:NumericUpDownWithLabel Label="Defense value" Minimum="{Binding OriginalDefenseValue}" Maximum="{Binding MaxDefenseValue}" Value="{Binding DefenseValue, Mode=TwoWay}" IsVisible="{Binding CanAllocateCombatModifier, Converter={StaticResource BoolToVisibilityConverter}}" Grid.Row="1" />
                        <mc:EntryWithLabel Label="Defense value" Text="{Binding DefenseValue}" IsEnabled="False" IsVisible="{Binding CanAllocateCombatModifierBase, Converter={StaticResource BoolToVisibilityConverter}}" Grid.Row="1" />
                        <mc:EntryWithLabel Label="Defense value" Text="{Binding DefenseValueWithSelectedWeapon}" IsEnabled="False" IsVisible="{Binding CanAllocateCombatModifierWithWeapon, Converter={StaticResource BoolToVisibilityConverter}}" Grid.Row="1" />

                        <mc:NumericUpDownWithLabel Label="Aim value" Minimum="{Binding OriginalAimValue}" Maximum="{Binding MaxAimValue}" Value="{Binding AimValue, Mode=TwoWay}" IsVisible="{Binding CanAllocateCombatModifier, Converter={StaticResource BoolToVisibilityConverter}}" Grid.Row="1" Grid.Column="1" />
                        <mc:EntryWithLabel Label="Aim value" Text="{Binding AimValue}" IsEnabled="False" IsVisible="{Binding CanAllocateCombatModifierBase, Converter={StaticResource BoolToVisibilityConverter}}" Grid.Row="1" Grid.Column="1" />
                        <mc:EntryWithLabel Label="Aim value" Text="{Binding AimValueWithSelectedWeapon}" IsEnabled="False" IsVisible="{Binding CanAllocateCombatModifierWithWeapon, Converter={StaticResource BoolToVisibilityConverter}}" Grid.Row="1" Grid.Column="1" />

                        <mc:EntryWithLabel Label="Combat modifier" Text="{Binding CombatValueModifier}" IsEnabled="False" Grid.Row="2" />
                        <mc:EntryWithLabel Label="Combat modifier/level" Text="{Binding CombatValueModifierPerLevel}" IsEnabled="False" Grid.Row="2" Grid.Column="1" />
                    </Grid>
                    <Grid ColumnDefinitions="*, *" RowDefinitions="Auto, Auto, Auto">
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <!-- ᛉ-pontok -->
            <Border Style="{StaticResource BoxBorder}">
                <VerticalStackLayout>
                    <Label Text="ᛉ-points" Style="{StaticResource HeaderLabel}"/>
                    <Grid ColumnDefinitions="*, *" RowSpacing="5" RowDefinitions="Auto, Auto">
                        <mc:EntryWithLabel Label="Max. ᛉp" Text="{Binding MaxPsiPoints}" IsEnabled="False" />
                        <mc:EntryWithLabel Label="Act. ᛉp" Text="{Binding PsiPoints}" IsEnabled="False" Grid.Row="1" />
                        <mc:EntryWithLabel Label="Max. ᛉp/level" Text="{Binding PsiPointsModifier}" IsEnabled="False" Grid.Column="1" />
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <!-- Mana-pontok -->
            <Border Style="{StaticResource BoxBorder}">
                <VerticalStackLayout>
                    <Label Text="Mana-points" Style="{StaticResource HeaderLabel}"/>
                    <Grid ColumnDefinitions="*, *" RowSpacing="5" RowDefinitions="Auto, Auto">
                        <mc:EntryWithLabel Label="Max. Mp" Text="{Binding MaxManaPoints}" IsEnabled="False" />
                        <mc:EntryWithLabel Label="Akt. Mp" Text="{Binding ManaPoints}" IsEnabled="False" Grid.Row="1" />
                        <mc:EntryWithLabel Label="Max. Mp/level" Text="{Binding MaxManaPointsPerLevel}" IsEnabled="False" Grid.Column="1" />
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <!-- Mágiaellenállás és ᛉ-pajzsok -->
            <Border Style="{StaticResource BoxBorder}">
                <VerticalStackLayout>
                    <Label Text="Magic Resistance" Style="{StaticResource HeaderLabel}"/>
                    <Grid ColumnDefinitions="*, *" RowSpacing="5" RowDefinitions="Auto, Auto, Auto">
                        <mc:EntryWithLabel Label="Unconscious Astral Magic Resistance" Text="{Binding UnconsciousAstralMagicResistance}" IsEnabled="False" />
                        <mc:EntryWithLabel Label="Unconscious Mental Magic Resistance" Text="{Binding UnconsciousMentalMagicResistance}" IsEnabled="False" Grid.Column="1" />
                        <mc:EntryWithLabel Label="Static Astral ᛉ-Shield" Text="{Binding StaticAstralPsiShield}" IsEnabled="False" Grid.Row="1" />
                        <mc:EntryWithLabel Label="Static Mental ᛉ-Shield" Text="{Binding StaticMentalPsiShield}" IsEnabled="False" Grid.Row="1" Grid.Column="1" />
                        <mc:EntryWithLabel Label="Dynamic Astral ᛉ-Shield" Text="{Binding DynamicAstralPsiShield}" IsEnabled="False" Grid.Row="2" />
                        <mc:EntryWithLabel Label="Dynamic Mental ᛉ-Shield" Text="{Binding DynamicMentalPsiShield}" IsEnabled="False" Grid.Row="2" Grid.Column="1" />
                    </Grid>
                </VerticalStackLayout>
            </Border>
            
        </VerticalStackLayout>

        <!-- Képzettségek -->
        <Border Style="{StaticResource BoxBorder}" Margin="0,10">
            <VerticalStackLayout>
                <Grid ColumnDefinitions="*,*">
                    <mc:EntryWithLabel Label="SP" Text="{Binding QualificationPoints}" IsEnabled="False" />
                    <mc:MenuItem ImageName="qualifications" LabelText="Qualifications" PageType="{x:Type mv:QualificationsPage}" WidthRequest="100" HeightRequest="100" Grid.Column="1"
                                 Parameter="{Binding Character}" IsVisible="{Binding CanAllocateQualificationPoints, Converter={StaticResource BoolToVisibilityConverter}}" />
                </Grid>

                <Label Text="Qualifications" Style="{StaticResource HeaderLabel}" />
                <Grid Padding="6" ColumnDefinitions="*, Auto" ColumnSpacing="10">
                    <Label Text="Name" VerticalOptions="Center" TextColor="Gray" FontAttributes="Bold"/>
                    <Label Text="Level" VerticalOptions="Center" HorizontalOptions="End" TextColor="Gray" FontAttributes="Bold"/>
                </Grid>

                <CollectionView ItemsSource="{Binding Qualifications, Converter={StaticResource QualificationSorter}}" SelectionMode="None" HeightRequest="280">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="local:Qualification">
                            <Grid Padding="6" ColumnDefinitions="*,Auto" ColumnSpacing="10">
                                <Label Text="{Binding ., Converter={StaticResource QualificationNameConverter}}" VerticalOptions="Center" HorizontalOptions="Start" />
                                <Label Text="{Binding QualificationLevel, Converter={StaticResource TranslationConverter}}" VerticalOptions="Center" HorizontalTextAlignment="End" />
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </VerticalStackLayout>
        </Border>

        <!-- Százalékos képzettségek -->
        <Border Style="{StaticResource BoxBorder}" Margin="0,10">
            <VerticalStackLayout>
                <Label Text="Percent qualifications" Style="{StaticResource HeaderLabel}" />
                <Grid Padding="6" ColumnDefinitions="*, Auto" ColumnSpacing="10">
                    <Label Text="Name" VerticalOptions="Center" TextColor="Gray" FontAttributes="Bold"/>
                    <Label Text="%" VerticalOptions="Center" HorizontalOptions="End" TextColor="Gray" FontAttributes="Bold"/>
                </Grid>

                <CollectionView ItemsSource="{Binding PercentQualifications, Converter={StaticResource QualificationSorter}}" SelectionMode="None" HeightRequest="280">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="local:PercentQualification">
                            <Grid Padding="6" ColumnDefinitions="*,Auto" ColumnSpacing="10">
                                <Label Text="{Binding Name, Converter={StaticResource TranslationConverter}}" VerticalOptions="Center" HorizontalOptions="Start" />
                                <Label Text="{Binding Percent}" VerticalOptions="Center" HorizontalTextAlignment="End" />
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </VerticalStackLayout>
        </Border>

        <!-- Speciális képességek -->
        <Border Style="{StaticResource BoxBorder}" Margin="0,10">
            <VerticalStackLayout>
                <Label Text="Special Abilities" Style="{StaticResource HeaderLabel}" />
                <Grid Padding="6" ColumnDefinitions="*" ColumnSpacing="10">
                    <Label Text="Name" VerticalOptions="Center" TextColor="Gray" FontAttributes="Bold"/>
                </Grid>

                <CollectionView ItemsSource="{Binding SpecialQualifications, Converter={StaticResource QualificationSorter}}" SelectionMode="None" HeightRequest="280">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="q:ISpecialQualification">
                            <Grid Padding="6" ColumnDefinitions="*" ColumnSpacing="10">
                                <Label Text="{Binding ., Converter={StaticResource SpecialQualificationNameConverter}}" VerticalOptions="Center" HorizontalOptions="Start" />
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </VerticalStackLayout>
        </Border>

        <!-- Pénz -->
        <Grid ColumnDefinitions="*,*">
            <Border Style="{StaticResource BoxBorder}">
                <VerticalStackLayout>
                    <Label Text="Money" Style="{StaticResource HeaderLabel}"/>
                    <Grid ColumnDefinitions="*, *" RowDefinitions="Auto, Auto">
                        <mc:EntryWithLabel Label="Copper" Text="{Binding Copper}" IsEnabled="False" />
                        <mc:EntryWithLabel Label="Silver" Text="{Binding Silver}" IsEnabled="False" Grid.Row="1" />
                        <mc:EntryWithLabel Label="Gold" Text="{Binding Gold}" IsEnabled="False" Grid.Column="1" />
                        <mc:EntryWithLabel Label="Mithril" Text="{Binding Mithril}" IsEnabled="False" Grid.Row="1" Grid.Column="1" />
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <mc:MenuItem ImageName="market" LabelText="Market" PageType="{x:Type mv:MarketPage}" WidthRequest="100" HeightRequest="100" Parameter="{Binding Character}" Grid.Column="1" />
        </Grid>

        <!-- Felszerelés -->
        <Border Style="{StaticResource BoxBorder}" Margin="0,10">
            <VerticalStackLayout>
                <Label Text="Equipment" Style="{StaticResource HeaderLabel}" />
                <Grid Padding="6" ColumnDefinitions="*, Auto" ColumnSpacing="10">
                    <Label Text="Name" VerticalOptions="Center" TextColor="Gray" FontAttributes="Bold"/>
                    <Label Text="Weight (kg)" VerticalOptions="Center" HorizontalOptions="End" TextColor="Gray" FontAttributes="Bold"/>
                </Grid>

                <CollectionView ItemsSource="{Binding Equipment, Converter={StaticResource EquipmentSorter}}" SelectionMode="None" HeightRequest="280">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="t:Thing">
                            <Grid Padding="6" ColumnDefinitions="*,Auto" ColumnSpacing="10">
                                <Label Text="{Binding Name, Converter={StaticResource TranslationConverter}}" VerticalOptions="Center" HorizontalOptions="Start" />
                                <Label Text="{Binding Weight, Converter={StaticResource TranslationConverter}}" VerticalOptions="Center" HorizontalTextAlignment="End" />
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
                <Grid Padding="6" ColumnDefinitions="*,Auto" ColumnSpacing="10" Margin="0,6,0,0">
                    <Label Text="Total weight (kg)" VerticalOptions="Center" TextColor="Gray" FontAttributes="Bold" />
                    <Label Text="{Binding TotalEquipmentWeight}" FontAttributes="Bold" HorizontalOptions="End" Margin="0,4,10,0" />
                </Grid>
            </VerticalStackLayout>
        </Border>

    </VerticalStackLayout>
</ContentView>
