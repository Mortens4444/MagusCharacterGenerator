<?xml version="1.0" encoding="utf-8" ?>
<v:NotifierPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
                xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
                xmlns:v="clr-namespace:Mtf.LanguageService.MAUI.Views;assembly=Mtf.LanguageService.MAUI"
                xmlns:vm="clr-namespace:M.A.G.U.S.Assistant.ViewModels"
                xmlns:conv="clr-namespace:Mtf.Maui.Controls.Converters;assembly=Mtf.Maui.Controls"
                xmlns:c="clr-namespace:Mtf.LanguageService.MAUI.Converters;assembly=Mtf.LanguageService.MAUI"
                x:Class="M.A.G.U.S.Assistant.Views.ItemDetailsPage"
                x:DataType="vm:ItemDetailsViewModel"
                x:ClassModifier="internal"
                Title="{Binding Name}">

    <v:NotifierPage.Resources>
        <ResourceDictionary>
            <conv:StringNotNullOrEmptyConverter x:Key="NotNullOrEmpty" />
            <c:TranslationConverter x:Key="TranslationConverter" />
        </ResourceDictionary>
    </v:NotifierPage.Resources>

    <ScrollView>
        <StackLayout Padding="12" Spacing="12">

            <Border Padding="12" Stroke="#E6E6E6">
                <VerticalStackLayout>
                    <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto,Auto,Auto" ColumnSpacing="16" RowSpacing="12">

                        <VerticalStackLayout Grid.Row="0" Grid.Column="0" Spacing="6">
                            <HorizontalStackLayout Spacing="8">
                                <Label Text="Price" FontAttributes="Bold" />
                                <Label Text="{Binding Money, StringFormat=': {0}'}" />
                            </HorizontalStackLayout>

                            <HorizontalStackLayout Spacing="8">
                                <Label Text="Weight (kg)" FontAttributes="Bold" />
                                <Label Text="{Binding Weight, StringFormat=': {0:F1}'}" />
                            </HorizontalStackLayout>

                            <BoxView HeightRequest="1" BackgroundColor="#E6E6E6" />
                        </VerticalStackLayout>

                        <Border Grid.Row="0" Grid.Column="1" Grid.RowSpan="3" Padding="6" Stroke="#E6E6E6"
                                StrokeShape="RoundRectangle 10" VerticalOptions="Start" HorizontalOptions="End">
                            <Image Source="{Binding DefaultImage}" Aspect="AspectFit" WidthRequest="140" HeightRequest="140">
                                <Image.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding PreviewImageCommand}" />
                                </Image.GestureRecognizers>
                            </Image>
                        </Border>

                        <VerticalStackLayout Grid.Row="1" Grid.Column="0" Spacing="6" IsVisible="{Binding IsRunecraftingVisible}">
                            <Label Text="Runecraft item" FontAttributes="Bold" />
                            <Picker ItemsSource="{Binding RuneTargets}"
                                    SelectedItem="{Binding SelectedRuneTarget}"
                                    ItemDisplayBinding="{Binding Name, Converter={StaticResource TranslationConverter}}"
                                    Title="Select target item" />

                            <BoxView HeightRequest="1" BackgroundColor="#E6E6E6" />
                        </VerticalStackLayout>

                        <Label Grid.Row="2" Grid.Column="0" Text="Description" FontAttributes="Bold"
                               IsVisible="{Binding Description, Converter={StaticResource NotNullOrEmpty}}" />

                        <Label Grid.Row="3" Grid.Column="0" Text="{Binding Description}" LineBreakMode="WordWrap"
                               IsVisible="{Binding Description, Converter={StaticResource NotNullOrEmpty}}" />
                    </Grid>

                    <BoxView Grid.Row="1" HeightRequest="1" BackgroundColor="#404040" Margin="0,8" />
                    
                    <Grid ColumnDefinitions="*,*,*,*,*" RowDefinitions="Auto" ColumnSpacing="10" IsVisible="{Binding IsWeapon}">
                        <VerticalStackLayout Grid.Column="0">
                            <Label Text="Attacks per round" FontSize="Caption" />
                            <Label Text="{Binding Weapon.AttacksPerRound}" FontAttributes="Bold" />
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Column="1">
                            <Label Text="Damage" FontSize="Caption" />
                            <Label Text="{Binding WeaponDamage}" FontAttributes="Bold" />
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Column="2">
                            <Label Text="Initiator value" FontSize="Caption" />
                            <Label Text="{Binding Weapon.InitiateValue}" FontAttributes="Bold" />
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Column="3" IsVisible="{Binding IsMelee}">
                            <Label Text="Attack value" FontSize="Caption" />
                            <HorizontalStackLayout Spacing="2">
                                <Label Text="{Binding MeleeWeapon.AttackValue}" FontAttributes="Bold" />
                            </HorizontalStackLayout>
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Column="4" IsVisible="{Binding IsMelee}">
                            <Label Text="Defense value" FontSize="Caption" />
                            <HorizontalStackLayout Spacing="2">
                                <Label Text="{Binding MeleeWeapon.DefenseValue}" FontAttributes="Bold" />
                            </HorizontalStackLayout>
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Column="3" IsVisible="{Binding IsRanged}">
                            <Label Text="Aim value" FontSize="Caption" />
                            <Label Text="{Binding RangedWeapon.AimValue}" FontAttributes="Bold" />
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Column="4" IsVisible="{Binding IsRanged}">
                            <Label Text="Distance (meter)" FontSize="Caption" />
                            <Label Text="{Binding RangedWeapon.Distance}" FontAttributes="Bold" />
                        </VerticalStackLayout>
                    </Grid>
                    <Grid ColumnDefinitions="*,*,*,*,*" RowDefinitions="Auto" ColumnSpacing="10" IsVisible="{Binding IsShield}">
                        <VerticalStackLayout Grid.Column="0">
                            <Label Text="Attacks per round" FontSize="Caption" />
                            <Label Text="{Binding Shield.AttacksPerRound}" FontAttributes="Bold" />
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Column="1">
                            <Label Text="Damage" FontSize="Caption" />
                            <Label Text="{Binding WeaponDamage}" FontAttributes="Bold" />
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Column="2">
                            <Label Text="Defense value" FontSize="Caption" />
                            <HorizontalStackLayout Spacing="2">
                                <Label Text="{Binding Weapon.DefenseValue}" FontAttributes="Bold" />
                            </HorizontalStackLayout>
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Column="3">
                            <Label Text="Weight (kg)" FontSize="Caption" />
                            <Label Text="{Binding Shield.Weight}" FontAttributes="Bold" />
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Column="4">
                            <Label Text="ACP" FontSize="Caption" />
                            <Label Text="{Binding Shield.MovementObstructiveFactor}" FontAttributes="Bold" />
                        </VerticalStackLayout>
                    </Grid>
                    <Grid ColumnDefinitions="*,*,*,*" RowDefinitions="Auto" ColumnSpacing="10" IsVisible="{Binding IsArmor}">
                        <VerticalStackLayout Grid.Column="0">
                            <Label Text="AC" FontSize="Caption" />
                            <Label Text="{Binding Armor.ArmorClass}" FontAttributes="Bold" />
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Column="1">
                            <Label Text="ACP" FontSize="Caption" />
                            <Label Text="{Binding Armor.ArmorCheckPenalty}" FontAttributes="Bold" />
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Column="2">
                            <Label Text="Protected parts" FontSize="Caption" />
                            <Label Text="{Binding ProtectedMainPlacesText}" FontAttributes="Bold" />
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Column="3">
                            <Label Text="Weight (kg)" FontSize="Caption" />
                            <Label Text="{Binding Armor.Weight}" FontAttributes="Bold" />
                        </VerticalStackLayout>
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <HorizontalStackLayout Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="2" HorizontalOptions="Center" Spacing="12" Margin="0,8,0,0">
                <Button Text="Buy" Command="{Binding BuyCommand}" CornerRadius="10" >
                    <Button.Triggers>
                        <DataTrigger TargetType="Button" Binding="{Binding IsBuyButtonVisible}" Value="False">
                            <Setter Property="IsVisible" Value="False" />
                        </DataTrigger>
                    </Button.Triggers>
                </Button>

                <Button Text="Close" Command="{Binding CloseCommand}" CornerRadius="10" />
            </HorizontalStackLayout>

        </StackLayout>
    </ScrollView>
</v:NotifierPage>
