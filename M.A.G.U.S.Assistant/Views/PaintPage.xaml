<?xml version="1.0" encoding="utf-8" ?>
<v:NotifierPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    xmlns:v="clr-namespace:M.A.G.U.S.Assistant.Views"
    xmlns:vm="clr-namespace:M.A.G.U.S.Assistant.ViewModels"
    x:Class="M.A.G.U.S.Assistant.Views.PaintPage"
    BackgroundColor="Black">

    <v:NotifierPage.BindingContext>
        <vm:PaintViewModel />
    </v:NotifierPage.BindingContext>

    <Grid RowDefinitions="Auto,Auto,*,Auto" Padding="8" RowSpacing="6">
        <ScrollView Orientation="Horizontal" Grid.Row="0">
            <HorizontalStackLayout Spacing="8" Padding="6">
                <Button WidthRequest="36" HeightRequest="36" BackgroundColor="Black" Command="{Binding PickPresetColorCommand}" CommandParameter="Black" />
                <Button WidthRequest="36" HeightRequest="36" BackgroundColor="White" Command="{Binding PickPresetColorCommand}" CommandParameter="White" />
                <Button WidthRequest="36" HeightRequest="36" BackgroundColor="SaddleBrown" Command="{Binding PickPresetColorCommand}" CommandParameter="SaddleBrown" />
                <Button WidthRequest="36" HeightRequest="36" BackgroundColor="Red" Command="{Binding PickPresetColorCommand}" CommandParameter="Red" />
                <Button WidthRequest="36" HeightRequest="36" BackgroundColor="Orange" Command="{Binding PickPresetColorCommand}" CommandParameter="Orange" />
                <Button WidthRequest="36" HeightRequest="36" BackgroundColor="Yellow" Command="{Binding PickPresetColorCommand}" CommandParameter="Yellow" />
                <Button WidthRequest="36" HeightRequest="36" BackgroundColor="Green" Command="{Binding PickPresetColorCommand}" CommandParameter="Green" />
                <Button WidthRequest="36" HeightRequest="36" BackgroundColor="Blue" Command="{Binding PickPresetColorCommand}" CommandParameter="Blue" />
                <Button WidthRequest="36" HeightRequest="36" BackgroundColor="Purple" Command="{Binding PickPresetColorCommand}" CommandParameter="Purple" />
                <Button WidthRequest="36" HeightRequest="36" BackgroundColor="Transparent" BorderColor="Gray" Text="+" Command="{Binding OpenColorPickerCommand}" />
            </HorizontalStackLayout>
        </ScrollView>

        <CollectionView Grid.Row="1" ItemsLayout="HorizontalList" ItemsSource="{Binding ItemOptions}" HeightRequest="76" SelectionMode="Single" SelectedItem="{Binding SelectedItemOption}">
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Grid Padding="6">
                        <Frame Padding="4" CornerRadius="6" HasShadow="False" BackgroundColor="White">
                            <Image Source="{Binding Icon}" WidthRequest="56" HeightRequest="56" Aspect="AspectFit" />
                        </Frame>
                    </Grid>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <!--<GraphicsView x:Name="CanvasView" Drawable="{Binding CanvasDrawable}">
            <GraphicsView.Behaviors>
                <toolkit:TouchEffect Capture="True" TouchAction="OnTouchAction" />
            </GraphicsView.Behaviors>
        </GraphicsView>-->
        
        <Frame Grid.Row="2" HasShadow="True" CornerRadius="8" Padding="0" >
            <GraphicsView x:Name="CanvasView" Drawable="{Binding CanvasDrawable}" BackgroundColor="Transparent"
                          HorizontalOptions="Fill" VerticalOptions="Fill" HeightRequest="520"
                          StartInteraction="CanvasView_StartInteraction"
                          DragInteraction="CanvasView_DragInteraction"
                          EndInteraction="CanvasView_EndInteraction"
                          CancelInteraction="CanvasView_CancelInteraction">
                <GraphicsView.GestureRecognizers>
                    <PanGestureRecognizer PanUpdated="OnPanUpdated" />                    
                    <PinchGestureRecognizer PinchUpdated="OnPinchUpdated" />
                </GraphicsView.GestureRecognizers>
            </GraphicsView>
        </Frame>

        <HorizontalStackLayout Grid.Row="3" Spacing="8" Padding="4">
            <Button Text="Undo" Command="{Binding UndoCommand}" />
            <Button Text="Clear" Command="{Binding ClearCommand}" />
            <Label Text="Size" VerticalOptions="Center" />
            <Slider Minimum="10" Maximum="300" Value="{Binding ShapeSize}" WidthRequest="160" />
            <Label Text="Mode" VerticalOptions="Center" />
            <Picker Title="Mode" ItemsSource="{Binding Modes}" SelectedIndex="{Binding SelectedModeIndex}" WidthRequest="140" />
        </HorizontalStackLayout>
    </Grid>
</v:NotifierPage>
