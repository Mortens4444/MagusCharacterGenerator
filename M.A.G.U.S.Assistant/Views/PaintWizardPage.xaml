<v:NotifierPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
                 xmlns:c="clr-namespace:Mtf.LanguageService.MAUI.Converters;assembly=Mtf.LanguageService.MAUI"
                 xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
                 xmlns:v="clr-namespace:Mtf.LanguageService.MAUI.Views;assembly=Mtf.LanguageService.MAUI"
                 xmlns:vm="clr-namespace:M.A.G.U.S.Assistant.ViewModels"
                 xmlns:m="clr-namespace:M.A.G.U.S.Assistant.Models"
                 xmlns:conv="clr-namespace:M.A.G.U.S.Assistant.Converters"
                 xmlns:local="clr-namespace:M.A.G.U.S.Assistant.Enums"
                 x:Class="M.A.G.U.S.Assistant.Views.PaintWizardPage"
                 x:ClassModifier="internal"
                 x:DataType="vm:PaintWizardViewModel"
                 Title="Paint">

    <v:NotifierPage.Resources>
        <ResourceDictionary>
            <conv:ToolToThicknessConverter x:Key="ToolToThicknessConverter" />
            <conv:ColorComparisonConverter x:Key="ColorComparisonConverter" />
        </ResourceDictionary>
    </v:NotifierPage.Resources>
    
    <Grid RowDefinitions="*, 120" ColumnDefinitions="80, *, 80" BackgroundColor="Black">

        <VerticalStackLayout Grid.Column="0" Spacing="10" Padding="10" BackgroundColor="#222">
            <Button Text="âŸ²" Clicked="OnNewPageClicked" BackgroundColor="Orange" ToolTipProperties.Text="Clear all"/>

            <BoxView HeightRequest="1" BackgroundColor="#444" HorizontalOptions="Fill" Margin="0,5" />
            
            <Button Text="â›‹" FontSize="12" Command="{Binding SelectToolCommand}" CommandParameter="{x:Static local:PaintTool.Fill}"
                    BorderWidth="{Binding ActiveTool, Converter={StaticResource ToolToThicknessConverter}, ConverterParameter={x:Static local:PaintTool.Fill}}" BorderColor="White" />
            <Button Text="Ã†" FontSize="12" Command="{Binding SelectToolCommand}" CommandParameter="{x:Static local:PaintTool.Text}"
                    BorderWidth="{Binding ActiveTool, Converter={StaticResource ToolToThicknessConverter}, ConverterParameter={x:Static local:PaintTool.Text}}" BorderColor="White" />
            <Button Text="Ã—" FontSize="12" Command="{Binding SelectToolCommand}" CommandParameter="{x:Static local:PaintTool.Eraser}"
                    BorderWidth="{Binding ActiveTool, Converter={StaticResource ToolToThicknessConverter}, ConverterParameter={x:Static local:PaintTool.Eraser}}" BorderColor="White" />
            <Button Text="â˜©" FontSize="12" Command="{Binding SelectToolCommand}" CommandParameter="{x:Static local:PaintTool.Move}"
                    BorderWidth="{Binding ActiveTool, Converter={StaticResource ToolToThicknessConverter}, ConverterParameter={x:Static local:PaintTool.Move}}" BorderColor="White" />
            
            <Label Text="BG" FontSize="10" HorizontalOptions="Center"/>
            <Border WidthRequest="40" HeightRequest="40" BackgroundColor="{Binding BackgroundColor}">
                <Border.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding SetBackgroundCommand}"/>
                </Border.GestureRecognizers>
            </Border>
        </VerticalStackLayout>

        <Border Grid.Column="1" Margin="5" StrokeThickness="0" BackgroundColor="{Binding BackgroundColor}" VerticalOptions="Fill" HorizontalOptions="Fill">
            <GraphicsView x:Name="CanvasView"
                          Drawable="{Binding DrawingLogic}"
                          BackgroundColor="Transparent"
                          StartInteraction="OnTouchStart"
                          DragInteraction="OnTouchDrag"
                          EndInteraction="OnTouchEnd" />
        </Border>

        <VerticalStackLayout Grid.Column="2" Spacing="10" Padding="10" BackgroundColor="#222">
            <Button Text="âœŽ" Command="{Binding SelectToolCommand}" CommandParameter="{x:Static local:PaintTool.Pencil}"
                    BorderWidth="{Binding ActiveTool, Converter={StaticResource ToolToThicknessConverter}, ConverterParameter={x:Static local:PaintTool.Pencil}}" BorderColor="White" />
            <Button Text="â€”" Command="{Binding SelectToolCommand}" CommandParameter="{x:Static local:PaintTool.Line}"
                    BorderWidth="{Binding ActiveTool, Converter={StaticResource ToolToThicknessConverter}, ConverterParameter={x:Static local:PaintTool.Line}}" BorderColor="White" />
            <Button Text="â¬œ" Command="{Binding SelectToolCommand}" CommandParameter="{x:Static local:PaintTool.Rect}"
                    BorderWidth="{Binding ActiveTool, Converter={StaticResource ToolToThicknessConverter}, ConverterParameter={x:Static local:PaintTool.Rect}}" BorderColor="White" />
            <Button Text="â—¯" Command="{Binding SelectToolCommand}" CommandParameter="{x:Static local:PaintTool.Circle}"
                    BorderWidth="{Binding ActiveTool, Converter={StaticResource ToolToThicknessConverter}, ConverterParameter={x:Static local:PaintTool.Circle}}" BorderColor="White" />

            <BoxView HeightRequest="1" BackgroundColor="#444" HorizontalOptions="Fill" Margin="0,5" />

            <Label Text="Fill" FontSize="10" HorizontalOptions="Center" TextColor="Gray"/>
            <CheckBox IsChecked="{Binding AutoFill}" HorizontalOptions="Center" Color="Orange"/>

            <Label Text="Oval" FontSize="10" HorizontalOptions="Center" TextColor="Gray"/>
            <CheckBox IsChecked="{Binding IsCircleRectMode}" HorizontalOptions="Center" Color="Cyan"/>
        </VerticalStackLayout>

        <VerticalStackLayout Grid.Row="1" Grid.ColumnSpan="3" BackgroundColor="#111">
            <Entry Text="{Binding DefaultText}" Placeholder="ð•¸.ð•¬.ð•².ð–€.ð•¾. - Òœ.Ô±.Î¨.â±£.â…ƒ." TextColor="White" BackgroundColor="#333" />
            <FlexLayout Wrap="Wrap" JustifyContent="Center" Padding="5">
                <BindableLayout.ItemsSource>
                    <Binding Path="Palette" />
                </BindableLayout.ItemsSource>
                <BindableLayout.ItemTemplate>
                    <DataTemplate x:DataType="Color">
                        <Border WidthRequest="40" HeightRequest="40" Margin="5" BackgroundColor="{Binding .}">
                            <Border.Stroke>
                                <MultiBinding Converter="{StaticResource ColorComparisonConverter}" ConverterParameter="Stroke">
                                    <Binding Source="{RelativeSource AncestorType={x:Type vm:PaintWizardViewModel}}" Path="SelectedColor" />
                                    <Binding Path="." />
                                </MultiBinding>
                            </Border.Stroke>
                            <Border.StrokeThickness>
                                <MultiBinding Converter="{StaticResource ColorComparisonConverter}" ConverterParameter="Thickness">
                                    <Binding Source="{RelativeSource AncestorType={x:Type vm:PaintWizardViewModel}}" Path="SelectedColor" />
                                    <Binding Path="." />
                                </MultiBinding>
                            </Border.StrokeThickness>
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="8"/>
                            </Border.StrokeShape>
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type vm:PaintWizardViewModel}}, Path=SelectColorCommand}" CommandParameter="{Binding .}"/>
                            </Border.GestureRecognizers>
                            <BoxView Color="Transparent" />
                        </Border>
                    </DataTemplate>
                </BindableLayout.ItemTemplate>
            </FlexLayout>
        </VerticalStackLayout>
    </Grid>
</v:NotifierPage>